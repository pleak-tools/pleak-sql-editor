!function($){jQuery.fn.contextMenu=function(name,actions,options){var win=$(window);return this.bind("contextmenu",{name:name,actions:actions,options:options},function(e){var name=e.data.name,actions=e.data.actions;if((options=e.data.options).leftClick&&0==e.button||!options.leftClick&&2==e.button){activeElement=$(this),options.showMenu&&options.showMenu.call(menu,activeElement);var menu=$('<ul id="'+name+'" class="context-menu"></ul>').hide().appendTo("body"),activeElement=null,hideMenu=function(){$(".context-menu:visible").each(function(){$(this).trigger("closed"),$(this).hide(),$("body").unbind("click",hideMenu)}),options.hideMenu&&options.hideMenu.call(menu,activeElement)},options=$.extend({disable_native_context_menu:!1,leftClick:!1},options);$(document).bind("contextmenu",function(e){options.disable_native_context_menu&&e.preventDefault(),hideMenu()}),$.each(actions,function(me,itemOptions){if(itemOptions.link)var link=itemOptions.link;else link='<a href="#">'+me+"</a>";var menuItem=$("<li>"+link+"</li>");itemOptions.klass&&menuItem.attr("class",itemOptions.klass),menuItem.appendTo(menu).bind("click",function(e){d3.event=e,itemOptions.click(activeElement),e.preventDefault()}).bind("mouseover",function(e){d3.event=e,itemOptions.mouseover(activeElement),e.preventDefault()}).bind("mouseout",function(e){d3.event=e,itemOptions.mouseout(activeElement),e.preventDefault()})}),hideMenu(),menu.css({visibility:"hidden",position:"absolute",zIndex:1e3});var mWidth=menu.outerWidth(!0),mHeight=menu.outerHeight(!0),xPos=e.pageX-win.scrollLeft()+mWidth<win.width()?e.pageX:e.pageX-mWidth,yPos=e.pageY-win.scrollTop()+mHeight<win.height()?e.pageY:e.pageY-mHeight;return menu.show(0,function(){$("body").bind("click",hideMenu)}).css({visibility:"visible",top:yPos+"px",left:xPos+"px",zIndex:1e3}),!1}})}}(jQuery);